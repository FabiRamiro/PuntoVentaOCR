<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<ScrollPane xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.pos.puntoventaocr.controllers.ValidarOCRController" fitToWidth="true" fitToHeight="true" hbarPolicy="AS_NEEDED" vbarPolicy="AS_NEEDED">
   <content>
      <VBox spacing="10.0" style="-fx-padding: 10;">
         <children>
            <!-- Título -->
            <HBox alignment="CENTER_LEFT" style="-fx-background-color: #f8f9fa; -fx-padding: 15;">
               <children>
                  <Label style="-fx-font-size: 20px; -fx-font-weight: bold;" text="Validación de Comprobantes OCR" />
               </children>
            </HBox>

            <!-- Panel de carga y procesamiento -->
            <VBox spacing="15.0" style="-fx-padding: 15; -fx-border-color: #dee2e6; -fx-border-radius: 5;">
               <children>
                  <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="1. Cargar Comprobante de Transferencia" />
                  <Separator />

                  <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10;">
                     <children>
                        <VBox spacing="10.0">
                           <children>
                              <Label text="Seleccionar archivo:" />
                              <HBox spacing="10.0">
                                 <children>
                                    <TextField fx:id="txtRutaArchivo" editable="false" prefWidth="300.0" promptText="Seleccione imagen del comprobante..." />
                                    <Button fx:id="btnSeleccionarArchivo" onAction="#seleccionarArchivo" text="Examinar..." />
                                 </children>
                              </HBox>
                              <Label style="-fx-text-fill: #6c757d; -fx-font-size: 11px;" text="Formatos soportados: JPG, PNG, PDF" />
                           </children>
                        </VBox>

                        <VBox alignment="CENTER" spacing="10.0">
                           <children>
                              <Button fx:id="btnProcesarOCR" disable="true" onAction="#procesarOCR" style="-fx-background-color: #007bff; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 12;" text="Procesar con OCR" />
                              <ProgressIndicator fx:id="progressOCR" prefHeight="40.0" prefWidth="40.0" visible="false" />
                              <Label fx:id="lblEstadoProceso" text="" />
                           </children>
                        </VBox>
                     </children>
                  </HBox>

                  <!-- Vista previa de la imagen -->
                  <VBox alignment="CENTER" spacing="10.0">
                     <children>
                        <Label style="-fx-font-weight: bold;" text="Vista Previa del Comprobante" />
                        <ScrollPane fitToHeight="true" fitToWidth="true" prefHeight="400.0" prefWidth="800.0" style="-fx-border-color: #dee2e6;">
                           <content>
                              <ImageView fx:id="imgComprobante" fitHeight="380.0" fitWidth="780.0" pickOnBounds="true" preserveRatio="true" smooth="true" style="-fx-background-color: #f8f9fa; -fx-border-color: #dee2e6;" />
                           </content>
                        </ScrollPane>
                        <HBox alignment="CENTER" spacing="10.0">
                           <children>
                              <Button fx:id="btnZoomIn" onAction="#aumentarZoom" text="Zoom +" style="-fx-background-color: #28a745; -fx-text-fill: white;" />
                              <Button fx:id="btnZoomOut" onAction="#reducirZoom" text="Zoom -" style="-fx-background-color: #ffc107; -fx-text-fill: white;" />
                              <Button fx:id="btnZoomReset" onAction="#resetearZoom" text="Tamaño Original" style="-fx-background-color: #17a2b8; -fx-text-fill: white;" />
                              <Button fx:id="btnVerCompleta" onAction="#verImagenCompleta" text="Ver Imagen Completa" style="-fx-background-color: #6f42c1; -fx-text-fill: white;" />
                           </children>
                        </HBox>
                     </children>
                  </VBox>
               </children>
            </VBox>

            <!-- Panel de datos extraídos y validación -->
            <VBox spacing="15.0" style="-fx-padding: 15; -fx-border-color: #dee2e6; -fx-border-radius: 5;">
               <children>
                  <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="2. Datos Extraídos y Validación" />
                  <Separator />

                  <HBox spacing="20.0">
                     <children>
                        <!-- Formulario de datos extraídos -->
                        <VBox spacing="15.0" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-font-weight: bold;" text="Datos Extraídos del Comprobante" />

                              <GridPane hgap="10.0" vgap="10.0">
                                 <columnConstraints>
                                    <ColumnConstraints hgrow="NEVER" minWidth="120.0" />
                                    <ColumnConstraints hgrow="ALWAYS" />
                                 </columnConstraints>

                                 <children>
                                    <Label text="Banco Emisor:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <TextField fx:id="txtBancoEmisor" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                                    <Label text="Referencia:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <TextField fx:id="txtReferencia" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                                    <Label text="Monto:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                                    <TextField fx:id="txtMonto" GridPane.columnIndex="1" GridPane.rowIndex="2" />

                                    <Label text="Fecha:" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                                    <DatePicker fx:id="dpFecha" GridPane.columnIndex="1" GridPane.rowIndex="3" />

                                    <Label text="Cuenta Remitente:" GridPane.columnIndex="0" GridPane.rowIndex="4" />
                                    <TextField fx:id="txtCuentaRemitente" GridPane.columnIndex="1" GridPane.rowIndex="4" />

                                    <Label text="Beneficiario:" GridPane.columnIndex="0" GridPane.rowIndex="5" />
                                    <TextField fx:id="txtBeneficiario" GridPane.columnIndex="1" GridPane.rowIndex="5" />
                                 </children>
                              </GridPane>

                              <HBox spacing="10.0">
                                 <children>
                                    <Button fx:id="btnLimpiarFormulario" onAction="#limpiarFormulario" text="Limpiar" />
                                 </children>
                              </HBox>
                           </children>
                        </VBox>

                        <!-- Panel de validación -->
                        <VBox spacing="15.0" HBox.hgrow="ALWAYS">
                           <children>
                              <Label style="-fx-font-weight: bold;" text="Validación Automática" />

                              <!-- Indicadores de validación -->
                              <VBox spacing="8.0">
                                 <children>
                                    <HBox alignment="CENTER_LEFT" spacing="10.0">
                                       <children>
                                          <Label fx:id="lblValidacionMonto" style="-fx-font-size: 20px;" text="⏳" />
                                          <Label fx:id="txtValidacionMonto" text="Validando monto con venta..." />
                                       </children>
                                    </HBox>

                                    <HBox alignment="CENTER_LEFT" spacing="10.0">
                                       <children>
                                          <Label fx:id="lblValidacionFecha" style="-fx-font-size: 20px;" text="⏳" />
                                          <Label fx:id="txtValidacionFecha" text="Validando fecha de transferencia..." />
                                       </children>
                                    </HBox>

                                    <HBox alignment="CENTER_LEFT" spacing="10.0">
                                       <children>
                                          <Label fx:id="lblValidacionReferencia" style="-fx-font-size: 20px;" text="⏳" />
                                          <Label fx:id="txtValidacionReferencia" text="Verificando referencia única..." />
                                       </children>
                                    </HBox>
                                 </children>
                              </VBox>

                              <Separator />

                              <!-- Búsqueda de venta asociada -->
                              <VBox spacing="10.0">
                                 <children>
                                    <Label style="-fx-font-weight: bold;" text="Asociar con Venta" />
                                    <HBox spacing="10.0">
                                       <children>
                                          <TextField fx:id="txtBuscarVenta" prefWidth="150.0" promptText="Número de venta..." />
                                          <Button fx:id="btnBuscarVenta" onAction="#buscarVenta" text="Buscar" />
                                       </children>
                                    </HBox>
                                    <Label fx:id="lblVentaEncontrada" text="" />
                                 </children>
                              </VBox>

                              <Separator />

                              <!-- Observaciones -->
                              <VBox spacing="5.0">
                                 <children>
                                    <Label style="-fx-font-weight: bold;" text="Observaciones" />
                                    <TextArea fx:id="txtObservaciones" prefHeight="80.0" promptText="Agregue observaciones sobre la validación..." />
                                 </children>
                              </VBox>
                           </children>
                        </VBox>
                     </children>
                  </HBox>

                  <!-- Botones de acción principales - Siempre visibles al final -->
                  <Separator />
                  <HBox alignment="CENTER" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #f8f9fa;">
                     <children>
                        <Button fx:id="btnValidar" disable="true" onAction="#validarComprobante" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14px; -fx-padding: 12 20;" text="✓ Validar Comprobante" />
                        <Button fx:id="btnRechazar" disable="true" onAction="#rechazarComprobante" style="-fx-background-color: #dc3545; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14px; -fx-padding: 12 20;" text="✗ Rechazar Comprobante" />
                     </children>
                  </HBox>
               </children>
            </VBox>

            <!-- Barra de estado -->
            <ToolBar style="-fx-background-color: #e9ecef;">
               <items>
                  <Label fx:id="lblEstadoGeneral" text="Listo para procesar comprobantes" />
                  <Region HBox.hgrow="ALWAYS" />
                  <Label fx:id="lblTiempoProcesamientoOCR" text="" />
               </items>
            </ToolBar>
         </children>
      </VBox>
   </content>
</ScrollPane>
